<?xml version="1.0" encoding="UTF-8"?>
<project name="adam_targets" default="jar">
<!--  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% SRC %%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<path id="classpath">
		<pathelement location="${classesfolder}"/>
		<path refid="${subproject}.classpath" />
	</path>
	
	<target name="javac" description="Compile logics code">
		<invoke-javac 
			dependencies="${subproject}.libs" 
			classpath="classpath"
			src="${srcfolder}"
			output="${classesfolder}"/>
	</target>

<!--  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% TESTS %%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<path id="tests.classpath">
		<path refid="classpath" />
		<pathelement location="${testclassesfolder}"/>
		<path refid="testng.classpath" />
	</path>

	<target name="tests.javac" depends="javac" description="Compile test code">
		<depend srcdir="${testfolder}" destdir="${testclassesfolder}" classpath="${classesfolder}"/>
		<invoke-javac
			dependencies="tests.libs"
			classpath="tests.classpath"
			src="${testfolder}"
			output="${testclassesfolder}" />
		<invoke-javac
			dependencies="tests.libs"
			classpath="tests.classpath"
			src="${macros.basedir}/test"
			output="${testclassesfolder}" />
	</target>
	
	<target name="test" depends="tests.javac,create-xml" description="Run tests">
		<invoke-testng 
			outputdir="${reportsfolder}/all"
			testclassesclasspath="tests.classpath"
			testclassesfolder="${testclassesfolder}"
			examplesfolder="${examplesfolder}"/>
	</target>

	<target name="test-class" depends="tests.javac" description="Compile logics test code">
		<invoke-test-class
			reportsfolder="${reportsfolder}"
			testclassesclasspath="tests.classpath"
			testclassesfolder="${testclassesfolder}"
			examplesfolder="${examplesfolder}"/>
	</target>

	<target name="test-method" depends="tests.javac" description="Compile logics test code">
		<invoke-test-method
			reportsfolder="${reportsfolder}"
			testclassesclasspath="tests.classpath"
			testclassesfolder="${testclassesfolder}"
			examplesfolder="${examplesfolder}"/>
	</target>

	<target name="create-xml" description="Creates the testng.xml for the test suite">
		<java classname="uniol.apt.tasks.WriteTestsXML" failonerror="true">
			<classpath refid="tests.classpath" />
			<arg path="testng.xml" />
			<arg path="${testclassesfolder}" />
			<arg value="*Test.class" />
		</java>
	</target>
<!--  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% JAVADOC %%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<target name="javadoc" description="Generate logics documentation from java source">
		<invoke-javadoc
			sourcefolder="${srcfolder}"
			testfolder="${testfolder}"
			classpath="tests.classpath"
			output="${javadocfolder}"/>
	</target>

<!--  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% JAR %%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<union id="jar.res">    	
			<fileset dir="${classesfolder}"/>	
			<resources refid="${subproject}.jar.res" />
	</union>

	<target name="jar-standalone" depends="javac" description="Builds a logics jar file. Also contains all files of the needed dependencies.">
		<invoke-jar-standalone outputfolder="${subproject.basedir}" filesuffix="${subproject}" resources="jar.res"/>
	</target>

	<target name="jar" depends="javac" description="Builds a logics jar file. Also contains all files of the needed dependencies.">
		<invoke-jar outputfolder="${subproject.basedir}" filesuffix="${subproject}" classesfolder="${classesfolder}"/>
	</target>

<!--  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% CLEANING %%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<target name="clean" description="Cleans this project">
		<invoke-clean
			classesfolder="${classesfolder}"
			testclassesfolder="${testclassesfolder}"
			javadocfolder="${javadocfolder}"
			subproject="${subproject}"/>
	</target>

	<target name="clean-all" description="Cleans this project, including the reports">
		<invoke-clean-all
			classesfolder="${classesfolder}"
			testclassesfolder="${testclassesfolder}"
			javadocfolder="${javadocfolder}"
			subproject="${subproject}"
		    reportsfolder="${reportsfolder}" />
	</target>
</project>
